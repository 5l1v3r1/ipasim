From 5686e88aa925560284f5787988c1f0e40d67389c Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jan=20Jone=C5=A1?= <jjones@outlook.cz>
Date: Mon, 13 May 2019 16:37:02 +0200
Subject: [PATCH] Squash branch `port`

---
 .gitignore           |  5 +++++
 cmake/LIEFGit.cmake  | 10 +++++++---
 src/MachO/Binary.cpp |  8 ++++++--
 3 files changed, 18 insertions(+), 5 deletions(-)
 create mode 100644 .gitignore

diff --git a/.gitignore b/.gitignore
new file mode 100644
index 0000000..da779e0
--- /dev/null
+++ b/.gitignore
@@ -0,0 +1,5 @@
+# [port] CHANGED: Added. See [gtm].
+/.gtm/
+
+# [port] CHANGED: Added.
+/build/
diff --git a/cmake/LIEFGit.cmake b/cmake/LIEFGit.cmake
index 16586c3..ae3aa14 100644
--- a/cmake/LIEFGit.cmake
+++ b/cmake/LIEFGit.cmake
@@ -50,7 +50,11 @@ endif()
 message(STATUS "Current branch: ${LIEF_GIT_BRANCH}")
 
 
-list(GET VERSION_STRING 0 LIEF_VERSION_MAJOR)
-list(GET VERSION_STRING 1 LIEF_VERSION_MINOR)
-list(GET VERSION_STRING 2 LIEF_VERSION_PATCH)
+# [port] CHANGED: Commented out this section and added the next one. See #20.
+#list(GET VERSION_STRING 0 LIEF_VERSION_MAJOR)
+#list(GET VERSION_STRING 1 LIEF_VERSION_MINOR)
+#list(GET VERSION_STRING 2 LIEF_VERSION_PATCH)
+set(LIEF_VERSION_MAJOR 0)
+set(LIEF_VERSION_MINOR 9)
+set(LIEF_VERSION_PATCH 0)
 
diff --git a/src/MachO/Binary.cpp b/src/MachO/Binary.cpp
index 399bc04..95332d1 100644
--- a/src/MachO/Binary.cpp
+++ b/src/MachO/Binary.cpp
@@ -207,7 +207,9 @@ it_libraries Binary::libraries(void) {
   libraries_t result;
 
   for (LoadCommand* library: this->commands_) {
-    if (typeid(*library) == typeid(DylibCommand)) {
+    // [port] CHANGED: Added the second part of this condition. See #22.
+    if (typeid(*library) == typeid(DylibCommand) &&
+        library->command() != LOAD_COMMAND_TYPES::LC_ID_DYLIB) {
       result.push_back(dynamic_cast<DylibCommand*>(library));
     }
   }
@@ -219,7 +221,9 @@ it_const_libraries Binary::libraries(void) const {
   libraries_t result;
 
   for (LoadCommand* library: this->commands_) {
-    if (typeid(*library) == typeid(DylibCommand)) {
+    // [port] CHANGED: Added the second part of this condition. See #22.
+    if (typeid(*library) == typeid(DylibCommand) &&
+        library->command() != LOAD_COMMAND_TYPES::LC_ID_DYLIB) {
       result.push_back(dynamic_cast<DylibCommand*>(library));
     }
   }
-- 
2.18.0.windows.1

